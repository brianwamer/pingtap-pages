// ===== ポーズ/レジューム（広告・バックグラウンド用） =====
let _animHandle = null;
function _raf(fn){ _animHandle = requestAnimationFrame(fn); }
function _cancelRaf(){ if(_animHandle) cancelAnimationFrame(_animHandle), _animHandle = null; }

function pauseGame(){
  if (playing) { playing = false; }
  stopBGM();
}
function resumeGame(){
  if (!playing && S.style.display==='none' && O.style.display==='none') {
    startBGM(baseBPM);
    playing = true;
  }
}
document.addEventListener('visibilitychange', ()=>{
  if (document.hidden) pauseGame();
  else resumeGame();
});

// __pingtap へ公開（ネイティブから叩ける）
window.__pingtap = Object.assign(window.__pingtap||{}, {
  pause: pauseGame, resume: resumeGame,
  setFg:(s,yo=0)=>{FG_SCALE=s;FG_Y_OFFSET=yo;}
});