<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>PingTap Safe Diag</title>
<style>
  html,body{margin:0;height:100%;background:#0b1224}
  #hud{position:fixed;inset:env(safe-area-inset-top) 0 auto 0;display:flex;gap:8px;
       padding:8px 12px;font:700 16px system-ui;color:#fff}
  .pill{background:#0b1224cc;border-radius:14px;padding:8px 12px}
  canvas{display:block;width:100vw;height:100vh;touch-action:manipulation}
</style>
<div id="hud">
  <div class="pill" id="sc">Score 0</div>
  <div class="pill" id="st">Tap anywhere to start</div>
</div>
<canvas id="cv"></canvas>
<script>
const cv=document.getElementById('cv'), g=cv.getContext('2d');
let DPR=1,W=0,H=0; function fit(){DPR=devicePixelRatio||1; W=innerWidth*DPR; H=innerHeight*DPR; cv.width=W; cv.height=H}
addEventListener('resize',()=>{fit();},{passive:true}); fit();

let running=false, t0=0, dur=900, tol=0.12, ringT=0, score=0;
let cx = 0.5, cy = 0.56; // 画面比（ここを上げ下げすると位置が変わる）

function hud(){document.getElementById('sc').textContent='Score '+score}
function start(){running=true; ringT=performance.now(); loop(ringT)}
function tap(){
  if(!running){start();return}
  const err=Math.abs((performance.now()-ringT)/dur-1);
  if(err<=tol){ score+=100; ringT=performance.now(); } else { score=0; }
  hud();
}
function loop(now){
  if(!running) return; requestAnimationFrame(loop);
  g.clearRect(0,0,W,H);
  const x=W*cx, y=H*cy, p=Math.min(1,(now-ringT)/dur);
  const rOut=76+(30-76)*(1-Math.pow(1-p,3));
  // outer ring
  g.save(); g.translate(x,y); g.strokeStyle='rgba(255,210,74,.95)';
  g.lineWidth=4*DPR; g.setLineDash([10,8]); g.beginPath(); g.arc(0,0,rOut,0,Math.PI*2); g.stroke();
  // base ring
  g.setLineDash([]); g.lineWidth=6*DPR; g.beginPath(); g.arc(0,0,30,0,Math.PI*2); g.stroke(); g.restore();
  // ball
  g.fillStyle='#ffeaa6'; g.beginPath(); g.arc(x,y-60*DPR*(1-p),8*DPR,0,Math.PI*2); g.fill();
}
['pointerdown','touchstart','mousedown','click'].forEach(t=>{
  addEventListener(t,tap,{passive:true});
  cv.addEventListener(t,tap,{passive:true});
});
hud();
</script>
